<html>

<head>
	<title>Import all the things</title>
	<script src="js/dropzone.js"></script>
	<script src="js/lib/jquery.js"></script>
	<link rel="stylesheet" type="text/css" href="css/basic.css">
	<link rel="stylesheet" type="text/css" href="css/dropzone.css">

	<script type="text/javascript">
	Dropzone.autoDiscover = false;

	$(document).ready(function() {
		$("#correlationId").val(new Date().getTime());
		var lastNodesFile = "nodes.csv";
		var lastRelationshipsFile = "relationships.csv";

		Dropzone.options.nodes = {
		  paramName: "nodes", 
		  maxFiles: 1,
		  dictDefaultMessage: "Drop nodes file here or click to find file",
		  success: function(file, done) {
		  	lastNodesFile = file.name;
		  },
		  	  
		};

		Dropzone.options.relationships = {
		  paramName: "relationships", 
		  maxFiles: 1,
		  dictDefaultMessage: "Drop relationships file here or click to find file",
		  success: function(file, done) {
		    lastRelationshipsFile = file.name;
		  }
		};		

		// add hooks to capture the last uploaded nodes/rels files
		// store that somewhere client side

		var nodes = new Dropzone("#nodes", { 
			url: "http://localhost:7474/tools/import/nodes?correlationId=" + $("#correlationId").val(),
			addRemoveLinks: true,
		});

		var rels = new Dropzone("#relationships", { 
			url: "http://localhost:7474/tools/import/relationships?correlationId=" + $("#correlationId").val(),
			addRemoveLinks: true, 			
		});

		$("#import-all-the-things").submit(function(e) {
			var uri = "http://localhost:7474/tools/import/incremental";
			uri += "?lastNodesFile=" + lastNodesFile;
			uri += "&lastRelationshipsFile=" + lastRelationshipsFile;
			uri += "&correlationId=" + $("#correlationId").val();
			
			$.ajax({
				url: uri,
				type: 'POST',
				success: function(response) {
					console.log(response);
				}
			});
			e.preventDefault();
		});
	});
	</script>
</head>
	<body>
		<h3>Neo4j Web Importer</h3>

		<p>
		To import data into your neo4j database you need to supply two files:
		<ol>
		<li>Nodes - this file should contain a tab delimited set of properties describing your nodes. It should contain a header line and the first column must be 'id' and will be used as an identifier for that node.</li>
		<li>Relationships - this file should contain a tab delimited set of properties describing your nodes. It should contain a header line and the first three columns must be: 

			<ul>
				<li>'from': an 'id' value for the relationship's source node.</li>
				<li>'to': an 'id' value for the relationship's destination node.</li>
				<li>'type': a string value representing the type of the relationship.</li>
			</ul>
		</li>
		</ol>		
		</p>

		<form id="import-all-the-things" action="http://localhost:7474/tools/import" method="POST" enctype="multipart/form-data">

			<input type="hidden" id="correlationId" />
			
			<p>
			<div id="nodes" class="dropzone" style="padding: 25px; display: inline-block; width: 50%; height:250px; float:left">
				<div class="fallback">
					<label for="nodes">Nodes:</label>
					<input type="file" name="nodes" id="nodes">
				</div>
			</div>	
			</p>		

			<p>

			<div id="relationships" class="dropzone"  style="padding: 25px;display: inline-block; width: 50%; height:250px;">
				<div class="fallback">
					<label for="relationships">Relationships:</label>
					<input type="file" name="relationships" id="relationships">
				</div>
			</div>
			</p>
		
			<input id="process-import" type="submit" name="submit" value="Import Data">
		</form>

	</body>
</html>
